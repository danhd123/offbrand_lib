<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>offbrand: Main Page</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />

<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">offbrand
   
   </div>
   <div id="projectbrief">A collection of generic, reference counted datastructures in C for C</div>
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li class="current"><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">offbrand Documentation</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>offbrand is a collection of reference counted generic data structures written in pure C for the C programmer. The library is intended to relieve the common need to reimplement a standard data structures in an application. Never again need to write an automatically resizing array for your application specific datatype and use the vector included in offbrand instead.</p>
<p>offbrand is based upon C style classes, and currently provides the following data structures out of the box:</p>
<ul>
<li>OBDeque: A double ended linked list</li>
<li>OBInt: an arbitrary precision integer</li>
<li>OBMap: A hash table with constant time insert and lookup</li>
<li>OBString: a classic string type with more convenience methods than your standard c string.</li>
<li>OBVector: an automatically resizing array</li>
</ul>
<p>The library also includes a script, mkobc (MaKe OffBrand Class), that generates new class skeletons for you, so you don't have to write a single piece of the boilerplate code required to make a datatype compatible with the data structure library. Just generate your new type with the script and add application specific logic to the generated files.</p>
<p><em>NOTE</em>: The phrase "class" is used in this documentation to refer to a C style approximation of a class built from functions and incomplete types, rather than a traditional class in a language like Java or Ruby <br/>
<br/>
</p>
<h2><a class="anchor" id="Requirements"></a>
Requirements</h2>
<p>offbrand requires the following tools:</p>
<ul>
<li>ar</li>
<li>gcc or clang</li>
<li>glibc</li>
<li>make</li>
</ul>
<p>Any Linux distro or OS X with developer tools installed should be able to build the library with no issue. At this time Windows is not supported. If you would like to build the documentation for the project on your local machine then the Doxygen package is also required.</p>
<p><b>Knowledge Base: </b> While the library is not terribly complex to use or understand, you should be comfortable with incomplete types, typecasting, and reference counted memory management to get the most out of offbrand. <br/>
<br/>
</p>
<h2><a class="anchor" id="Installation"></a>
Installation and Use</h2>
<p>To build the library on your machine, clone the git repository and make:</p>
<div class="fragment"><pre class="fragment">  $ git clone https:<span class="comment">//github.com/theck01/offbrand_lib.git</span>
  $ cd offbrand_lib
  $ make fresh # builds library and runs all unit tests
</pre></div><p>If you do not want or need to run unit tests then subsitutue "make fresh" with "make". If you use clang rather than gcc edit the Makefile to contain the set the CC variable to clang:</p>
<div class="fragment"><pre class="fragment">  CC = clang #rather than CC = gcc
</pre></div><p>Using offbrand is as simple as including some headers from the include/ subdirectory and linking your application to the bin/offbrand.a library archive. <br/>
<br/>
</p>
<h2><a class="anchor" id="Examples"></a>
Examples</h2>
<p>Example applications can be found in the app/ subdirectory. The following example is the code for the pfinder application, a prime number generator:</p>
<div class="fragment"><pre class="fragment"><span class="preprocessor">  #include &quot;<a class="code" href="offbrand_8h.html" title="Offbrand Standard Library.">include/offbrand.h</a>&quot;</span>
<span class="preprocessor">  #include &quot;<a class="code" href="OBInt_8h.html" title="OBInt Public Interface.">include/OBInt.h</a>&quot;</span>
<span class="preprocessor">  #include &quot;<a class="code" href="OBString_8h.html" title="OBString Public Interface.">include/OBString.h</a>&quot;</span>
<span class="preprocessor">  #include &quot;<a class="code" href="OBVector_8h.html" title="OBVector Public Interface.">include/OBVector.h</a>&quot;</span>
  
  <span class="keywordtype">int</span> <a class="code" href="OBDeque__test_8c.html#ae66f6b31b5ad750f1fe042a706a4e3d4">main</a>(){
  
    uint64_t i, maybe_prime;
    <a class="code" href="structOBInt__struct.html" title="OBInt internal structure, encapsulating all data needed for an instance of OBInt.">OBInt</a> *candidate, *next, *remainder;
    <a class="code" href="structOBString__struct.html" title="OBString internal structure, encapsulating all data needed for an instance of OBString.">OBString</a> *numstr;
    <a class="code" href="structOBVector__struct.html" title="OBVector internal structure, encapsulating all data needed for an instance of OBVector.">OBVector</a> *primes;
  
    <span class="comment">// create vector with a small initial capacity</span>
    primes = <a class="code" href="OBVector_8h.html#a6c8cc362a004f9a633c0dd467a3b56e1" title="Constructor, creates a new instance of OBVector with a given initial capacity.">createVector</a>(1);
  
    <span class="comment">// seed primes vector with initial prime 2. Note the cast of </span>
    <span class="comment">// the OBInt to obj, an OBVector stores the generic obj type rather than</span>
    <span class="comment">// any specific type</span>
    candidate = <a class="code" href="OBInt_8h.html#a1f02c8f09ff92d2fa86321ff9b047d98" title="Creates a new OBInt with the given integer.">createIntWithInt</a>(2);
    <a class="code" href="OBVector_8h.html#a02c81142e199aa0f6921d10548a41398" title="Stores the obj at the associated index in a vector, overwriting previous obj stored at that index and...">storeAtVectorIndex</a>(primes, (<a class="code" href="structobj__struct.html" title="Base struct used for within all Offbrand compatible classes that tracks information common to all cla...">obj</a> *)candidate, 0);
  
    <span class="comment">// release the candidate so the vector maintains the only reference to the</span>
    <span class="comment">// prime number. release operates on the generic obj type, so the pointer</span>
    <span class="comment">// is cast</span>
    <a class="code" href="offbrand_8h.html#a1f40f54a18fab14e0063bd088d3982ac" title="Decrements the instances reference count by 1. If the reference count is reduced to 0 then release au...">release</a>((<a class="code" href="structobj__struct.html" title="Base struct used for within all Offbrand compatible classes that tracks information common to all cla...">obj</a> *)candidate);
  
    <span class="comment">// begin the main prime finding loop</span>
    candidate = <a class="code" href="OBInt_8h.html#a1f02c8f09ff92d2fa86321ff9b047d98" title="Creates a new OBInt with the given integer.">createIntWithInt</a>(3);
    <span class="keywordflow">while</span>(1){
  
      maybe_prime = 1;
  
      <span class="comment">// search for a prime factor of candidate</span>
      <span class="keywordflow">for</span>(i=0; i&lt;<a class="code" href="OBVector_8h.html#a1f367610ccd6204e5b3b6c4933e4d175" title="Number of elements encompassed within the OBVector.">vectorLength</a>(primes); i++){
        remainder = <a class="code" href="OBInt_8h.html#a9cc7096ed62c0bafba5dbad71059a1a1" title="Creates a new OBInt containing the remainder of integer division between two OBInt values...">modInts</a>(candidate, (<a class="code" href="structOBInt__struct.html" title="OBInt internal structure, encapsulating all data needed for an instance of OBInt.">OBInt</a> *)<a class="code" href="OBVector_8h.html#a4e470c890fcb453912cb3798fd0dd9ee" title="Accesses the Offbrand compatile class instance stored an index in an OBVector.">objAtVectorIndex</a>(primes, i));
        <span class="comment">// if the remainder is 0 then the candidate number is not prime</span>
        <span class="keywordflow">if</span>(<a class="code" href="OBInt_8h.html#a21ec113e1bd950d67afd4b48368b0e00" title="Checks if an instance of OBInt is zero and returns the boolean truth value.">isIntZero</a>(remainder)) maybe_prime = 0;
        <a class="code" href="offbrand_8h.html#a1f40f54a18fab14e0063bd088d3982ac" title="Decrements the instances reference count by 1. If the reference count is reduced to 0 then release au...">release</a>((<a class="code" href="structobj__struct.html" title="Base struct used for within all Offbrand compatible classes that tracks information common to all cla...">obj</a> *)remainder);
        <span class="keywordflow">if</span>(!maybe_prime) <span class="keywordflow">break</span>;
      }
  
      <span class="comment">// if the number is still maybe prime then it is now definitely prime,</span>
      <span class="comment">// add it to the end of the primes vector</span>
      <span class="keywordflow">if</span>(maybe_prime){
        <a class="code" href="OBVector_8h.html#a02c81142e199aa0f6921d10548a41398" title="Stores the obj at the associated index in a vector, overwriting previous obj stored at that index and...">storeAtVectorIndex</a>(primes, (<a class="code" href="structobj__struct.html" title="Base struct used for within all Offbrand compatible classes that tracks information common to all cla...">obj</a> *)candidate, <a class="code" href="OBVector_8h.html#a1f367610ccd6204e5b3b6c4933e4d175" title="Number of elements encompassed within the OBVector.">vectorLength</a>(primes));
        numstr = <a class="code" href="OBInt_8h.html#aef957da47892207b350a1d97bdf0bbd1" title="Creates an instance of OBString containing a string representation of the value of an OBInt...">stringFromInt</a>(candidate);
        printf(<span class="stringliteral">&quot;Prime found: %s\n&quot;</span>, <a class="code" href="OBString_8h.html#a1763145d699a2cc9226ed7d2d1b144ba" title="Gets the C string representation of an OBString instance.">getCString</a>(numstr));
        <a class="code" href="offbrand_8h.html#a1f40f54a18fab14e0063bd088d3982ac" title="Decrements the instances reference count by 1. If the reference count is reduced to 0 then release au...">release</a>((<a class="code" href="structobj__struct.html" title="Base struct used for within all Offbrand compatible classes that tracks information common to all cla...">obj</a> *)numstr);
      }
  
      <span class="comment">// increment candidate by 2 and release old candidate, it is not needed</span>
      <span class="comment">// by main loop</span>
      next = <a class="code" href="OBInt_8h.html#aab2524f58e202e89ec6f3552f4399f19" title="Creates a new OBInt containing the sum of an OBInt and a machine integer.">addIntAndPrim</a>(candidate, 2); 
      <a class="code" href="offbrand_8h.html#a1f40f54a18fab14e0063bd088d3982ac" title="Decrements the instances reference count by 1. If the reference count is reduced to 0 then release au...">release</a>((<a class="code" href="structobj__struct.html" title="Base struct used for within all Offbrand compatible classes that tracks information common to all cla...">obj</a> *)candidate);
      candidate = next;
    }
  }
</pre></div><p>To build this example by hand (using gcc or clang):</p>
<div class="fragment"><pre class="fragment">  $ gcc -Wall -Wextra apps/pfinder/<a class="code" href="OBDeque__test_8c.html#ae66f6b31b5ad750f1fe042a706a4e3d4">main</a>.c bin/offbrand.a -o pfinder
</pre></div><p> <br/>
</p>
<h2><a class="anchor" id="Documentation"></a>
Documentation</h2>
<p>The API references for classes can be found at this location, under the Modules tab. The documentation for each class is broken down by file. The public header documentation outlines the entire public API for each class, and should have all of the information required to use offbrand with standard applications. Any apps that will extend or modify the library builtins may benefit from the private header documentation, where the structure of the class data and private functions are documented.</p>
<p>This Doxygen documentation can be built locally if the system has the doxygen package installed, by using the documentation target of the project Makefile:</p>
<div class="fragment"><pre class="fragment">  $ make documentation
</pre></div><p>After a successful build, documentation can be accessed in the docs/html/ subdirectory <br/>
<br/>
</p>
<h2><a class="anchor" id="FileStructure"></a>
File Structure</h2>
<p>An offbrand compatible class (or builtin class) is split across 5 different files:</p>
<h3><a class="anchor" id="DocumentationFile"></a>
Documentation File</h3>
<p>An optional file that serves to provide doxygen documentation for the general functionallity of the class. These files will be found in the docs/doxygen/ subdirectory of the library for builtin classes.</p>
<h3><a class="anchor" id="PublicHeader"></a>
Public Header</h3>
<p>Contains all functions operating on the class that are publicly accessable to call anywhere in any program. These files will be found in the include/ subdirectory of the library for builtin classes.</p>
<h3><a class="anchor" id="PrivateHeader"></a>
Private Header</h3>
<p>Containing all functions operating on the class that should not be called directly by other programs and the definitions of all structs encapsulated by the class. Builtin private headers can be found in the include/private/ subdirectory.</p>
<h3><a class="anchor" id="SourceFile"></a>
Source File</h3>
<p>Contains the implementation of all functions operating on the class, public and private. Source files for builtin classes can be be found in the src/classes/ subdirectory.</p>
<h3><a class="anchor" id="UnitTestFile"></a>
Unit Test File</h3>
<p>An optional file, contains unit tests used to verify proper functionallity of the class. Test files can be found in the src/tests/ subdirectory. <br/>
<br/>
</p>
<h2><a class="anchor" id="Extending"></a>
Extending the Library</h2>
<p>The offbrand library is intended to contain data structures common to many applications, but you are still left with the task of creating your own classes that are compatible with the library. Fortunately that task is not as tedious as it could be, the library includes a shell script to generate skeletons for all new classes.</p>
<p>mkobc (MaKe OffBrand Class) can be found in the scripts/ subdirectory. The best documentation for how to use the script can be found by running:</p>
<div class="fragment"><pre class="fragment">  $ scripts/mkobc -h
</pre></div><p>This script generates 5 files containing the initial basis for a new class. These files contain all code required to make a class compatible with the rest of the library, and contain comments describing what code can be changed and what code should not be changed to ensure compatibility is maintained. <br/>
<br/>
</p>
<h2><a class="anchor" id="Overview"></a>
How it Works</h2>
<p>offbrand is based on a property of the C language that dictates that all data types have a constant memory alignment, and that fields within a struct with be arranged sequentially in memory. That is, the memory layout of types within a struct can be reliably predicted, will be constant, and will be the same in two structs containing the same ordering of the same types of fields. A contrived example of how we can take advantage of this memory alignment:</p>
<div class="fragment"><pre class="fragment">  <span class="keyword">struct </span>B {
    <span class="keywordtype">int</span> i;
  };
 
  <span class="keyword">struct </span>A {
    <span class="keyword">struct </span>B element_b;
    <span class="keywordtype">int</span> j;
  };
 
  <span class="keyword">struct </span>A *thing_a = malloc(<span class="keyword">sizeof</span>(<span class="keyword">struct</span> A)); 
  thing_a-&gt;element_b.i = 10;
 
  <span class="comment">// A perfectly valid cast, you can now use the struct A as if it were a</span>
  <span class="comment">// struct B</span>
  <span class="keyword">struct </span>B *thing_b = (<span class="keyword">struct </span>B *)thing_a;
 
  <span class="comment">// prints 10 to stdout</span>
  printf(<span class="stringliteral">&quot;%d\n&quot;</span>, thing_b-&gt;i);
</pre></div><p>This memory alignment enables a struct A, which has struct B as it's first element, to be typecast and used as if it were struct B. In offbrand struct A is any of the offbrand classes and struct B is a special structure, "obj".</p>
<p>An obj ("object") encapsulates data common to all classes: a reference count, pointers to class specific versions of common functions, and a class name. obj is the generic type of the library, and casts from class pointers to obj pointers and back is common theme within offbrand code.</p>
<p>A standard library exists that operates exclusively on obj pointers. This basis allows any class instances to be compared, hashed, retained, released, etc. These functions call the class specific versions of each function, if they exist, hiding large numbers of class specific methods behind a small suite of common functions. <br/>
<br/>
</p>
<h2><a class="anchor" id="Contributing"></a>
Contributing</h2>
<p>Clone, fork, submit issues and pull requests on github: <a href="https://github.com/theck01/offbrand_lib">https://github.com/theck01/offbrand_lib</a> <br/>
<br/>
 </p>
</div></div><!-- contents -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>



<hr class="footer"/><address class="footer"><small>
Generated on Mon Jun 10 2013 10:51:51 for offbrand by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.6.1
</small></address>

</body>
</html>
